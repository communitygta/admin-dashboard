(self.webpackChunkcommunitygta_admin_panel=self.webpackChunkcommunitygta_admin_panel||[]).push([[5070],{5070:(e,n,t)=>{"use strict";t.r(n),t.d(n,{UserEditPageModule:()=>A});var o=t(8583),i=t(3679),r=t(3083),s=t(1182),a=t(5353),l=t(8002),c=t(3190),u=t(263),g=t(639),p=t(5332),h=t(1352);function d(e,n){if(1&e&&(g.TgZ(0,"ion-select-option",17),g._uU(1),g.qZA()),2&e){const e=n.$implicit;g.Q6J("value",e.value),g.xp6(1),g.hij("",e.name," ")}}function m(e,n){if(1&e&&(g.TgZ(0,"ion-select",15),g.YNc(1,d,2,2,"ion-select-option",16),g.qZA()),2&e){const e=g.oxw(2);g.xp6(1),g.Q6J("ngForOf",e.availableUserRoles)}}function f(e,n){if(1&e&&(g.TgZ(0,"ion-label",6),g._uU(1),g.qZA()),2&e){const e=g.oxw(2);g.xp6(1),g.Oqu(e.availableUserRoles[1].name)}}function v(e,n){if(1&e&&(g.TgZ(0,"ion-select-option",17),g._uU(1),g.qZA()),2&e){const e=n.$implicit;g.Q6J("value",e.id),g.xp6(1),g.Oqu(e.name)}}function O(e,n){if(1&e&&(g.TgZ(0,"ion-item",5),g.TgZ(1,"ion-label"),g._uU(2,"Managing"),g.qZA(),g.TgZ(3,"ion-select",18),g.YNc(4,v,2,2,"ion-select-option",16),g.qZA(),g.qZA()),2&e){const e=g.oxw(2);g.xp6(4),g.Q6J("ngForOf",e.availableNeighbourhoods)}}function _(e,n){if(1&e&&(g.TgZ(0,"ion-select-option",17),g._uU(1),g.qZA()),2&e){const e=n.$implicit;g.Q6J("value",e.id),g.xp6(1),g.Oqu(e.name)}}function b(e,n){if(1&e&&(g.TgZ(0,"ion-item",5),g.TgZ(1,"ion-label"),g._uU(2,"Managing"),g.qZA(),g.TgZ(3,"ion-select",19),g.YNc(4,_,2,2,"ion-select-option",16),g.qZA(),g.qZA()),2&e){const e=g.oxw(2);g.xp6(4),g.Q6J("ngForOf",e.availableOrganizations)}}function Z(e,n){if(1&e){const e=g.EpF();g.TgZ(0,"ion-button",20),g.NdJ("click",function(){g.CHM(e);const n=g.oxw().ngIf;return g.oxw().delete(n)}),g._UZ(1,"ion-icon",21),g._uU(2," Delete"),g.qZA()}}function C(e,n){if(1&e){const e=g.EpF();g.TgZ(0,"div",3),g.TgZ(1,"form",4),g.TgZ(2,"ion-item",5),g.TgZ(3,"ion-label"),g._uU(4,"User Name"),g.qZA(),g.TgZ(5,"ion-note",6),g._uU(6),g.qZA(),g.qZA(),g.TgZ(7,"ion-item",5),g.TgZ(8,"ion-label"),g._uU(9,"User Role"),g.qZA(),g.YNc(10,m,2,1,"ion-select",7),g.YNc(11,f,2,1,"ion-label",8),g.qZA(),g.TgZ(12,"ion-item",5),g.TgZ(13,"ion-label"),g._uU(14,"Email"),g.qZA(),g._UZ(15,"ion-input",9),g.qZA(),g.YNc(16,O,5,1,"ion-item",10),g.YNc(17,b,5,1,"ion-item",10),g.TgZ(18,"ion-item",5),g.TgZ(19,"ion-label"),g._uU(20,"Is Active"),g.qZA(),g._UZ(21,"ion-toggle",11),g.qZA(),g.TgZ(22,"ion-button",12),g.NdJ("click",function(){const n=g.CHM(e).ngIf;return g.oxw().update(n)}),g._UZ(23,"ion-icon",13),g._uU(24," Save"),g.qZA(),g.YNc(25,Z,3,0,"ion-button",14),g.qZA(),g.qZA()}if(2&e){const e=n.ngIf,t=g.oxw();g.xp6(1),g.Q6J("formGroup",t.form),g.xp6(5),g.Oqu(e.user.username),g.xp6(4),g.Q6J("ngIf",t.showUserRoles),g.xp6(1),g.Q6J("ngIf",!t.showUserRoles),g.xp6(5),g.Q6J("ngIf",1===t.userRole.value),g.xp6(1),g.Q6J("ngIf",2===t.userRole.value),g.xp6(5),g.Q6J("disabled",!t.form.dirty),g.xp6(3),g.Q6J("ngIf",t.showUserRoles)}}const P=[{path:"",component:(()=>{class e{constructor(e,n,t,o,i,r,s){this.authService=e,this.activatedRoute=n,this.dashboardService=t,this.fb=o,this.inAppMessageService=i,this.alertController=r,this.navController=s,this.showUserRoles=!1,this.userProfile$=this.getUserProfile(),this.availableUserRoles=[{value:1,name:"Neighbourhood Admin"},{value:2,name:"Organization Admin"}],this.initForm()}ngOnInit(){}get userRole(){return this.form.controls.userRole}update(e){this.form.invalid||(1===this.userRole.value?delete this.form.value.organization:delete this.form.value.neighbourhood,delete this.form.value.userRole,this.updateProfile(e,this.form.value))}delete(e){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.alertController.create({header:"Warning",message:"Are you sure to delete this user?",buttons:[{text:"Cancel",role:"cancel"},{text:"Yes, delete",cssClass:"danger",handler:()=>{this.authService.deleteUserProfileBySuperUser(e.id).subscribe(()=>{this.inAppMessageService.simpleAlert(null,"This user has been deleted.","OK",!1,()=>this.navController.navigateBack("user-list"))})}}]})).present()})}updateProfile(e,n){let t;this.authService.userRole===u.i4.superAdmin&&(t=this.authService.updateUserProfileBySuperUser(e.id,n)),this.authService.userRole===u.i4.neighbourhoodAdmin&&(t=this.authService.updateUserProfileByNeighbourhoodAdmin(e.id,n)),t.subscribe(()=>{this.inAppMessageService.simpleToast("This user has been updated.","bottom"),this.userProfile$=this.getUserProfile()})}initForm(){this.form=this.fb.group({userRole:[null],email:[null,[i.kI.required]],organization:[null],neighbourhood:[null],isActive:[null]})}updateForm(e){var n,t;return this.form.controls.email.patchValue(e.user.email),this.form.controls.organization.patchValue(null===(n=e.organization)||void 0===n?void 0:n.id),this.form.controls.neighbourhood.patchValue(null===(t=e.neighbourhood)||void 0===t?void 0:t.id),this.form.controls.isActive.patchValue(e.user.is_active),e.neighbourhood&&this.form.controls.userRole.patchValue(this.availableUserRoles[0].value),e.organization&&this.form.controls.userRole.patchValue(this.availableUserRoles[1].value),this.form.markAsPristine(),e}getNeighbourhoodOptions(){return this.dashboardService.getAllNeighbourhoods().pipe((0,l.U)(e=>this.availableNeighbourhoods=e))}getOrganizationOptions(){return this.authService.userRole===u.i4.superAdmin?this.dashboardService.getAllOrganizations().pipe((0,l.U)(e=>this.availableOrganizations=e)):this.authService.userRole===u.i4.neighbourhoodAdmin?this.dashboardService.getOrganizationsByNeighbourhoodId(this.authService.userProfile$.getValue().profile.neighbourhood.id).pipe((0,l.U)(e=>this.availableOrganizations=e)):void 0}getUserProfile(){return this.authService.userRole===u.i4.superAdmin?(this.showUserRoles=!0,this.getNeighbourhoodOptions().pipe((0,c.w)(()=>this.getOrganizationOptions()),(0,c.w)(()=>this.authService.getUserBySuperUser(this.activatedRoute.snapshot.params.id).pipe((0,l.U)(e=>this.updateForm(e)))))):this.authService.userRole===u.i4.neighbourhoodAdmin?this.getOrganizationOptions().pipe((0,c.w)(()=>this.authService.getUserByNeighbourhood(this.activatedRoute.snapshot.params.id).pipe((0,l.U)(e=>this.updateForm(e))))):void 0}}return e.\u0275fac=function(n){return new(n||e)(g.Y36(u.e8),g.Y36(s.gz),g.Y36(p.s),g.Y36(i.qu),g.Y36(h.r),g.Y36(r.Br),g.Y36(r.SH))},e.\u0275cmp=g.Xpm({type:e,selectors:[["app-user-edit"]],decls:9,vars:4,consts:[["slot","start"],["text","",3,"defaultHref"],["class","wrapper",4,"ngIf"],[1,"wrapper"],[1,"content-wrapper",3,"formGroup"],["lines","none"],["slot","end"],["formControlName","userRole",4,"ngIf"],["slot","end",4,"ngIf"],["formControlName","email","placeholder","email",2,"text-align","right"],["lines","none",4,"ngIf"],["formControlName","isActive","color","primary"],["size","small",3,"disabled","click"],["name","save-outline"],["size","small","color","danger",3,"click",4,"ngIf"],["formControlName","userRole"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","neighbourhood","placeholder","select a neighbourhood"],["formControlName","organization","placeholder","select a organization"],["size","small","color","danger",3,"click"],["name","trash-outline"]],template:function(e,n){1&e&&(g.TgZ(0,"ion-header"),g.TgZ(1,"ion-toolbar"),g.TgZ(2,"ion-buttons",0),g._UZ(3,"ion-back-button",1),g.qZA(),g.TgZ(4,"ion-title"),g._uU(5,"User Edit"),g.qZA(),g.qZA(),g.qZA(),g.TgZ(6,"ion-content"),g.YNc(7,C,26,8,"div",2),g.ALo(8,"async"),g.qZA()),2&e&&(g.xp6(3),g.Q6J("defaultHref","user-list"),g.xp6(4),g.Q6J("ngIf",g.lcZ(8,2,n.userProfile$)))},directives:[r.Gu,r.sr,r.Sm,r.oU,r.cs,r.wd,r.W2,o.O5,i._Y,i.JL,i.sg,r.Ie,r.Q$,r.uN,r.pK,r.j9,i.JJ,i.u,r.ho,r.w,r.YG,r.gu,r.t9,r.QI,o.sg,r.n0],pipes:[o.Ov],styles:["[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]{display:flex;align-items:self-start;flex-wrap:wrap}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{margin:30px;border-radius:15px;box-shadow:0 3px 10px #0003;overflow:hidden;padding:10px 0;position:relative;width:420px}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:14px;color:#444}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:13px;color:#707070;padding-bottom:15px;padding-top:15px}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{width:260px;max-width:100%;font-size:14px;text-align:right}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{font-size:14px}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{float:right;margin-top:10px;margin-right:20px}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]   .wrapper[_ngcontent-%COMP%]   .content-wrapper.update-password[_ngcontent-%COMP%]{width:300px}"]}),e})()}];let M=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=g.oAB({type:e}),e.\u0275inj=g.cJS({imports:[[s.Bz.forChild(P)],s.Bz]}),e})(),A=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=g.oAB({type:e}),e.\u0275inj=g.cJS({imports:[[o.ez,i.u5,i.UX,r.Pc,M]]}),e})()}}]);